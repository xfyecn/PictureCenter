<!DOCTYPE html>
<html>
<head>
	<title>Thumbnails</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    img{
      vertical-align: middle;
      margin: 5px;
    }
  </style>
</head>
<body>
    <form ref='uploadForm'
      id='uploadForm'
      action='/upload'
      method='post'
      encType="multipart/form-data">
        <input type="file" id="file_upload" name="sampleFile" accept="image/*" multiple>
    </form>
	<div id="container">
	</div>
</body>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
<script>
var downloadImage = function(data, filename) {
    var a = document.createElement('a');
    a.href = data;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
};
$(document).ready(function(e) {
	var input = $("#file_upload");
	input[0].addEventListener("change",readFile,false);
  var base64s = {};
	function readFile(){
		var files = this.files;
		//input.val("");
		//console.log(this.files);
		for(var i = 0; i < files.length; i++) {
			if(!/image\/\w+/.test(files[i].type)){
				alert("Please make sure the file is an image");
				return false;
			}
			(function(foo){
				var reader = new FileReader();
				reader.readAsDataURL(files[foo]);
				reader.onload = function(e){
					var curImg = new Image();
					curImg.src = this.result;
					curImg.onload = function(){
						var expectWidth = this.naturalWidth;
						var expectHeight = this.naturalHeight;
						expectWidth = 500;
						expectHeight = expectWidth*this.naturalHeight/this.naturalWidth;

						var canvas = document.createElement("canvas");
						var ctx = canvas.getContext("2d");
						canvas.width = expectWidth;
						canvas.height = expectHeight;
						ctx.clearRect(0, 0, canvas.width, canvas.height);
						ctx.drawImage(this, 0, 0, expectWidth, expectHeight);
						ctx.save();
            var thumbnailname = files[foo].name.split('.jpg')[0] + '_thumbnail.jpeg';
            downloadImage(canvas.toDataURL("image/jpeg", 0.5), thumbnailname);
					}
				}
			}(i));
		}
	}
});
</script>
</html>
